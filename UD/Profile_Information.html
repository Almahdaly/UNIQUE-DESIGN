<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile Information</title>
{% load static %}
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#4f46e5',secondary:'#a855f7'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Inter', sans-serif;
background-color: #f9fafb;
}
.profile-picture-container:hover .edit-overlay {
opacity: 1;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
.form-input:focus {
outline: none;
border-color: #4f46e5;
box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}
.edit-field-container:hover .edit-icon {
color: #4f46e5;
}
</style>
</head>
<body>
<header class="bg-white shadow-sm py-4 px-6">
<div class="container mx-auto flex items-center">
<a href="{% url 'UD:settings' %}" class="flex items-center justify-center w-10 h-10 text-gray-600 hover:bg-gray-100 rounded-full cursor-pointer">
<i class="ri-arrow-left-line ri-lg"></i>
</a>
<h1 class="text-xl font-semibold text-gray-800 ml-4">Profile Information</h1>
</div>
</header>

<!-- Messages Display -->
{% if messages %}
<div class="fixed top-4 right-4 z-50 space-y-2">
    {% for message in messages %}
    <div class="p-4 rounded-lg shadow-lg {% if message.tags == 'success' %}bg-green-500{% else %}bg-red-500{% endif %} text-white flex items-center justify-between min-w-[300px]">
        <span>{{ message }}</span>
        <button class="close-message">
            <i class="ri-close-line"></i>
        </button>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-50 to-gray-100">
<div class="w-full max-w-3xl bg-white rounded-xl shadow-lg overflow-hidden">
<div class="flex flex-col md:flex-row">
<!-- Left sidebar with profile picture -->
<div class="w-full md:w-1/3 bg-gray-50 p-8 flex flex-col items-center">
<div class="profile-picture-container relative group">
<div class="w-40 h-40 rounded-full overflow-hidden border-4 border-white shadow-md">
<img src="{% if profile.profile_image %}{{ profile.profile_image.url }}{% else %}{% static 'UD/images/default-profile.png' %}{% endif %}"
alt="Profile Picture"
class="w-full h-full object-cover object-top"
id="profile_image_preview">
</div>
<div class="edit-overlay absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300 cursor-pointer">
<label for="profile_image" class="cursor-pointer">
<i class="ri-camera-line ri-xl text-white"></i>
</label>
</div>
</div>
<h2 class="mt-6 text-2xl font-semibold text-gray-800">{{ user.get_full_name|default:user.username }}</h2>
</div>
<!-- Right side with profile information -->
<div class="w-full md:w-2/3 p-8">
<form method="POST" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}
    <input type="file" name="profile_image" id="profile_image" accept="image/*" class="hidden">
    
<!-- Full Name -->
    <div class="input-wrapper">
        <input type="text" name="full_name" id="full_name" 
               class="w-full px-4 py-3 border border-gray-300 rounded-button focus:border-primary focus:ring-1 focus:ring-primary"
               value="{{ user.first_name }}" required>
        <label for="full_name" class="text-gray-500">الاسم الكامل</label>
</div>

<!-- Email -->
    <div class="input-wrapper">
        <input type="email" name="email" id="email"
               class="w-full px-4 py-3 border border-gray-300 rounded-button focus:border-primary focus:ring-1 focus:ring-primary"
               value="{{ user.email }}" required>
        <label for="email" class="text-gray-500">البريد الإلكتروني</label>
</div>

    <!-- Change Password Button -->
    <div class="mt-6">
        <button type="button" id="changePasswordBtn" class="w-full bg-secondary text-white py-3 rounded-button hover:bg-secondary/90 transition-colors flex items-center justify-center gap-2">
            <i class="ri-lock-line"></i>
            <span>تغيير كلمة المرور</span>
</button>
</div>

<!-- Save Changes Button -->
    <button type="submit" class="w-full bg-primary text-white py-3 rounded-button hover:bg-primary/90 transition-colors flex items-center justify-center gap-2">
        <span>حفظ التغييرات</span>
        <i class="ri-save-line"></i>
</button>
</form>
</div>
</div>
</div>
</div>

<!-- Password Change Modal -->
<div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
    <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-800">تغيير كلمة المرور</h3>
            <button id="closePasswordModal" class="text-gray-500 hover:text-gray-700">
        <i class="ri-close-line ri-lg"></i>
      </button>
    </div>
        <form method="POST" class="space-y-4" id="passwordChangeForm">
            {% csrf_token %}
            <input type="hidden" name="password_change" value="true">
      <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">كلمة المرور الحالية</label>
                <input type="password" name="current_password" id="current_password" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded text-gray-800 bg-white" required>
                <div id="current_password_error" class="text-red-500 text-sm mt-1 hidden"></div>
      </div>
      <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">كلمة المرور الجديدة</label>
                <input type="password" name="new_password" id="new_password" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded text-gray-800 bg-white" required>
                <div id="new_password_error" class="text-red-500 text-sm mt-1 hidden"></div>
      </div>
      <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">تأكيد كلمة المرور الجديدة</label>
                <input type="password" name="confirm_password" id="confirm_password" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded text-gray-800 bg-white" required>
                <div id="confirm_password_error" class="text-red-500 text-sm mt-1 hidden"></div>
      </div>
      <div class="flex justify-end space-x-3 mt-6">
                <button type="button" id="cancelPasswordChange" class="px-4 py-2 border border-gray-300 rounded-button text-gray-700 hover:bg-gray-50 transition-all">إلغاء</button>
                <button type="submit" id="savePasswordChange" class="bg-primary text-white px-4 py-2 rounded-button font-medium hover:bg-opacity-90 transition-all">حفظ التغييرات</button>
      </div>
        </form>
    </div>
</div>

<script>
// Profile Image Preview
document.getElementById('profile_image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profile_image_preview').src = e.target.result;
        }
        reader.readAsDataURL(file);
    }
});

// Password change modal functionality
const passwordModal = document.getElementById('passwordModal');
const changePasswordBtn = document.getElementById('changePasswordBtn');
const closePasswordModal = document.getElementById('closePasswordModal');
const cancelPasswordChange = document.getElementById('cancelPasswordChange');

function showPasswordModal() {
    passwordModal.classList.remove('hidden');
    passwordModal.classList.add('flex');
    document.getElementById('passwordChangeForm').reset();
    validatePassword();
}

function hidePasswordModal() {
    passwordModal.classList.remove('flex');
    passwordModal.classList.add('hidden');
    document.getElementById('passwordChangeForm').reset();
    document.querySelectorAll('[id$="_error"]').forEach(el => {
        el.textContent = '';
        el.classList.add('hidden');
    });
}

changePasswordBtn.addEventListener('click', showPasswordModal);
closePasswordModal.addEventListener('click', hidePasswordModal);
cancelPasswordChange.addEventListener('click', hidePasswordModal);

passwordModal.addEventListener('click', function(e) {
    if (e.target === passwordModal) {
        hidePasswordModal();
    }
});

// Password validation
function validatePassword() {
    const currentPassword = document.getElementById('current_password');
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_password');
    const saveButton = document.getElementById('savePasswordChange');
    
    let isValid = true;
    
    document.querySelectorAll('[id$="_error"]').forEach(el => {
        el.textContent = '';
        el.classList.add('hidden');
    });
    
    if (!currentPassword.value) {
        document.getElementById('current_password_error').textContent = 'الرجاء إدخال كلمة المرور الحالية';
        document.getElementById('current_password_error').classList.remove('hidden');
        isValid = false;
    }
    
    if (!newPassword.value) {
        document.getElementById('new_password_error').textContent = 'الرجاء إدخال كلمة المرور الجديدة';
        document.getElementById('new_password_error').classList.remove('hidden');
        isValid = false;
    } else if (newPassword.value.length < 8) {
        document.getElementById('new_password_error').textContent = 'يجب أن تكون كلمة المرور الجديدة 8 أحرف على الأقل';
        document.getElementById('new_password_error').classList.remove('hidden');
        isValid = false;
    }
    
    if (!confirmPassword.value) {
        document.getElementById('confirm_password_error').textContent = 'الرجاء تأكيد كلمة المرور الجديدة';
        document.getElementById('confirm_password_error').classList.remove('hidden');
        isValid = false;
    } else if (newPassword.value !== confirmPassword.value) {
        document.getElementById('confirm_password_error').textContent = 'كلمتا المرور الجديدتان غير متطابقتين';
        document.getElementById('confirm_password_error').classList.remove('hidden');
        isValid = false;
    }
    
    saveButton.disabled = !isValid;
    saveButton.classList.toggle('opacity-50', !isValid);
    saveButton.classList.toggle('cursor-not-allowed', !isValid);
    
    return isValid;
}

['current_password', 'new_password', 'confirm_password'].forEach(id => {
    const input = document.getElementById(id);
    input.addEventListener('input', validatePassword);
    input.addEventListener('blur', validatePassword);
});

document.getElementById('passwordChangeForm').addEventListener('submit', function(e) {
    if (!validatePassword()) {
        e.preventDefault();
    }
});

// Auto-hide messages after 5 seconds
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.close-message');
    messages.forEach(message => {
    setTimeout(() => {
            message.closest('div').remove();
        }, 5000);
        
        message.addEventListener('click', function() {
            this.closest('div').remove();
        });
  });
});
</script>
</body>
</html>